# 트랜잭션
- 데이터베이스에서 **논리적 작업 단위** (쿼리 묶음)
- ACID 원칙을 지켜야 함
## 원자성(Atomicity)
- 트랜잭션의 작업은 **모두 실행**되거나 **전혀 실행되지 않아야** 한다 **(all or nothing)**
- 커밋과 롤백덕에 데이터 무결성이 보장
### 커밋 (Commit)
- 트랜잭션 정상 종료 후 데이터 영구 반영 (롤백 불가 → 되돌리려면 새 트랜잭션으로 반대 작업 수행)
<img width="516" height="238" alt="image" src="https://github.com/user-attachments/assets/6b9ba054-fa3e-48ab-9c94-e90682a9c429" />

### 롤백 (Rollback) 
- 트랜잭션 실패 시 원상 복구 
<img width="510" height="293" alt="image" src="https://github.com/user-attachments/assets/2241b916-6408-443a-8cb6-ae7f59444690" />

### 트랜잭션 전파 (Transaction Propagation)
- A 트랜잭션 내에서 B 트랜잭션 호출 시 동작 방식
- 스프링에서는 `REQUIRED`, `REQUIRES_NEW` 같은 옵션으로 설정
## 일관성(Consistency)
- **정의**: 트랜잭션 전후로 데이터가 모든 무결성 제약조건을 만족.
- 예: 외래키 제약, 유니크 제약 등이 깨지면 트랜잭션 실패.
## 격리성(Isolation)
- **정의**: 동시에 실행되는 트랜잭션들이 서로 영향을 주지 않도록 함
<img width="477" height="275" alt="image" src="https://github.com/user-attachments/assets/acc921f0-ecf8-4bf8-83b4-908c92c795ff" />

### 격리 수준에 따라 발생하는 현상
| 현상                                   | 설명              |
| ------------------------------------ | --------------- |
| **더티 리드 (Dirty Read)**               | 커밋되지 않은 데이터 읽음  |
| **반복 불가능한 조회 (Non-Repeatable Read)** | 같은 쿼리인데 값 바뀜    |
| **팬텀 리드 (Phantom Read)**             | 조건은 같은데 행 수가 바뀜 |

#### 팬텀 리드
#### 반복 가능하지 않은 조회
#### 더티 리드
### 격리 수준
| 수준                   | 방지되는 현상                     | 설명            |
| -------------------- | --------------------------- | ------------- |
| **READ UNCOMMITTED** | 없음                          | Dirty Read 허용 |
| **READ COMMITTED**   | Dirty Read                  | Oracle 기본     |
| **REPEATABLE READ**  | Dirty + Non-Repeatable Read | MySQL 기본      |
| **SERIALIZABLE**     | 모두 방지                       | 완전 격리, 성능 저하  |

#### SERIALIZABLE
#### REPEATEABLE_READ
#### READ_COMMITTED
#### READ_UNCOMMITTED
## 지속성(Durability)
- 트랜잭션이 커밋되면, 시스템 장애가 발생해도 결과는 보존되어야 한다.
- 디스크에 로그 등으로 기록 → 복구 가능
<img width="784" height="310" alt="image" src="https://github.com/user-attachments/assets/42b15136-80b5-4eeb-84e7-0f05dd087d86" />

# 무결성(Integrity)
- 데이터의 정확성·일관성·신뢰성을 유지하기 위한 제약조건
  
| 무결성 종류         | 설명                      |
| -------------- | ----------------------- |
| **개체 무결성**     | PK는 NULL, 중복 불가         |
| **참조 무결성**     | FK는 참조 대상 PK 존재 or NULL |
| **도메인 무결성**    | 필드값은 정의된 형식, 범위 따라야 함   |
| **사용자 정의 무결성** | 업무 규칙 기반 (예: 재고 ≥ 0)    |

<img width="623" height="265" alt="image" src="https://github.com/user-attachments/assets/4a84bf15-436d-4cc0-957a-1824a3c2ebf8" />

